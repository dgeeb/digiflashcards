import{r as V,a as M,p,i as T,q as B,c as i,b as t,t as l,w as F,d as y,e as v,v as b,f as k,g as w,h as U,F as q,m as E,o as u,j as D,k as $,z as L,x as S}from"./index-kXFCKEwh.js";const P={key:0,class:"stage-detail"},R={class:"stage-detail__header"},j={class:"stage-detail__meta"},z={class:"meta-value"},O={class:"meta-value"},G={class:"meta-value"},H={class:"stage-detail__form"},J={class:"form-grid"},K={class:"form-field"},Q={class:"form-field"},W={class:"form-field"},X={key:0,class:"form-error",role:"alert"},Y={class:"stage-detail__cards"},Z={class:"stage-detail__cards-header"},tt={class:"stage-detail__cards-actions"},et={key:0,class:"empty-state"},st={key:1,class:"card-table-wrapper"},ot={class:"card-table"},at={class:"card-table__front"},nt={key:0,class:"card-table__note"},rt=["onClick"],lt={key:1,class:"dashboard dashboard--empty"},dt={class:"empty-card"},mt={__name:"StageDetail",emits:["notify"],setup(it,{emit:C}){const g=C,_=T(),{updateCurrentUser:h}=$(),r=V({front:"",back:"",note:""}),m=M(""),c=p(()=>{var e,n;const o=_.params.courseId;return(n=(e=B.value)==null?void 0:e.courses.find(a=>a.id===o))!=null?n:null}),d=p(()=>{var e,n;const o=_.params.stageId;return(n=(e=c.value)==null?void 0:e.stages.find(a=>a.id===o))!=null?n:null}),f=p(()=>d.value?[...d.value.cards].map(o=>({id:o.id,front:o.front,back:o.back,note:o.note,status:o.due?new Date(o.due).getTime()<=Date.now()?"Due":"Scheduled":"New",due:x(o.due),mastery:"".concat(Math.round(o.mastery||0),"%")})):[]);function x(o){if(!o)return"New card";const e=new Date(o);if(Number.isNaN(e.getTime()))return"Unknown";const n=Date.now(),a=e.getTime()-n;if(a<=0)return"Due now";const s=Math.round(a/864e5);return s===0?"Later today":s===1?"Tomorrow":"In ".concat(s," days")}function N(){r.front="",r.back="",r.note="",m.value=""}function I(){if(!(!d.value||!c.value)){if(!r.front.trim()||!r.back.trim()){m.value="Both sides of the card are required.";return}h(o=>{const e=o.courses.find(a=>a.id===c.value.id);if(!e)return;const n=e.stages.find(a=>a.id===d.value.id);n&&(n.cards.push({id:L(),front:r.front.trim(),back:r.back.trim(),note:r.note.trim(),createdAt:new Date().toISOString(),status:"new",history:[],mastery:0,easeFactor:2.5,intervalDays:0,due:null}),S(n))}),g("notify","Card added to the stage!"),N()}}function A(o){!d.value||!c.value||(h(e=>{const n=e.courses.find(s=>s.id===c.value.id);if(!n)return;const a=n.stages.find(s=>s.id===d.value.id);a&&(a.cards=a.cards.filter(s=>s.id!==o),S(a))}),g("notify","Card removed."))}return(o,e)=>{var a;const n=U("router-link");return d.value&&c.value?(u(),i("section",P,[t("header",R,[t("div",null,[t("h1",null,l(d.value.title),1),t("p",null,l(d.value.description||"Describe what learners should achieve in this stage."),1)]),t("div",j,[t("div",null,[e[3]||(e[3]=t("span",{class:"meta-label"},"Stage points",-1)),t("span",z,l((a=d.value.points)!=null?a:0),1)]),t("div",null,[e[4]||(e[4]=t("span",{class:"meta-label"},"Cards",-1)),t("span",O,l(d.value.metrics.total),1)]),t("div",null,[e[5]||(e[5]=t("span",{class:"meta-label"},"Due today",-1)),t("span",G,l(d.value.metrics.due),1)])])]),t("section",H,[e[10]||(e[10]=t("h2",null,"Add a new card",-1)),t("form",{class:"inline-form",onSubmit:F(I,["prevent"])},[t("div",J,[t("div",K,[e[6]||(e[6]=t("label",{for:"card-front"},"Prompt",-1)),v(t("textarea",{id:"card-front","onUpdate:modelValue":e[0]||(e[0]=s=>r.front=s),rows:"3",placeholder:"Front of the card",required:""},null,512),[[b,r.front]])]),t("div",Q,[e[7]||(e[7]=t("label",{for:"card-back"},"Answer",-1)),v(t("textarea",{id:"card-back","onUpdate:modelValue":e[1]||(e[1]=s=>r.back=s),rows:"3",placeholder:"Back of the card",required:""},null,512),[[b,r.back]])])]),t("div",W,[e[8]||(e[8]=t("label",{for:"card-note"},"Extra notes (optional)",-1)),v(t("input",{id:"card-note","onUpdate:modelValue":e[2]||(e[2]=s=>r.note=s),type:"text",placeholder:"Mnemonic, example sentenceâ€¦"},null,512),[[b,r.note]])]),m.value?(u(),i("p",X,l(m.value),1)):y("",!0),e[9]||(e[9]=t("button",{class:"button button--success",type:"submit"},"Add card",-1))],32)]),t("section",Y,[t("header",Z,[t("div",null,[e[11]||(e[11]=t("h2",null,"Cards",-1)),t("p",null,l(f.value.length)+" card"+l(f.value.length===1?"":"s")+" in this stage.",1)]),t("div",tt,[k(n,{class:"button button--ghost",to:{name:"StageSession",params:{courseId:c.value.id,stageId:d.value.id}}},{default:w(()=>[...e[12]||(e[12]=[D(" Start revision ",-1)])]),_:1},8,["to"])])]),f.value.length?(u(),i("div",st,[t("table",ot,[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"Prompt"),t("th",{scope:"col"},"Answer"),t("th",{scope:"col"},"Status"),t("th",{scope:"col"},"Next review"),t("th",{scope:"col"},"Mastery"),t("th",{scope:"col"},"Actions")])],-1)),t("tbody",null,[(u(!0),i(q,null,E(f.value,s=>(u(),i("tr",{key:s.id},[t("td",null,[t("p",at,l(s.front),1),s.note?(u(),i("small",nt,l(s.note),1)):y("",!0)]),t("td",null,l(s.back),1),t("td",null,l(s.status),1),t("td",null,l(s.due),1),t("td",null,l(s.mastery),1),t("td",null,[t("button",{class:"link-button",type:"button",onClick:ut=>A(s.id)},"Remove",8,rt)])]))),128))])])])):(u(),i("p",et,"No cards yet. Add your first one above."))])])):(u(),i("section",lt,[t("div",dt,[e[15]||(e[15]=t("h1",null,"Stage not found",-1)),e[16]||(e[16]=t("p",null,"The stage you were looking for was not found.",-1)),k(n,{class:"button button--primary",to:{name:"Dashboard"}},{default:w(()=>[...e[14]||(e[14]=[D("Back to dashboard",-1)])]),_:1})])]))}}};export{mt as default};
