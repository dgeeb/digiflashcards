import{a as k,r as L,p as f,i as O,q as Q,A as U,B as W,C as X,c as u,b as s,t as n,D as V,d as q,E as Y,F as $,m as J,n as Z,R as ee,f as D,g as R,h as se,k as te,G as ae,x as oe,o as d,j as A,H as ne}from"./index-kXFCKEwh.js";const le={key:0,class:"session-page"},ie={class:"session-header"},re={class:"session-header__breadcrumb"},ue={class:"session-header__stats"},de={class:"meta-value"},ce={class:"meta-value"},ve={class:"meta-value"},pe=["aria-valuenow"],_e={key:0,class:"session-content"},fe={class:"session-card__header"},me={key:0,class:"session-card__note"},he={class:"session-card__body"},be={class:"session-card__face session-card__face--front"},ge={class:"session-card__face session-card__face--back","aria-live":"polite"},ke={key:0},ye={key:1,class:"session-card__hidden"},we={class:"session-card__footer"},Ce={class:"session-navigation"},Se=["disabled"],De=["disabled"],Re={class:"session-actions","aria-label":"Rating shortcuts"},Ae=["onClick","disabled"],Ee={class:"button__shortcut"},Ie={class:"button__label"},Ne={class:"session-actions__description"},Be={key:1,class:"session-complete"},Pe={class:"session-complete__card"},Te={key:0},xe={key:1},Le={class:"session-complete__actions"},Ue={key:1,class:"dashboard dashboard--empty"},Ve={class:"empty-card"},Me={__name:"StageSession",emits:["notify"],setup(qe,{emit:H}){const M=H,w=O(),{updateCurrentUser:G}=te(),r=k([]),i=k(!1),y=k(!1),a=L({reviewed:0,completed:0,points:0,total:0}),p=L({}),m=k([]),C=k(!1),_=f(()=>{var e,o;const t=w.params.courseId;return(o=(e=Q.value)==null?void 0:e.courses.find(l=>l.id===t))!=null?o:null}),c=f(()=>{var e,o;const t=w.params.stageId;return(o=(e=_.value)==null?void 0:e.stages.find(l=>l.id===t))!=null?o:null}),v=f(()=>{var t;return(t=r.value[0])!=null?t:null}),j=f(()=>r.value.length),z=f(()=>m.value.length>0),S=f(()=>a.total?Math.round(a.completed/a.total*100):0),F=ee;function K(){r.value=ne(c.value,{limitNew:15}),a.reviewed=0,a.completed=0,a.points=0,a.total=r.value.length,y.value=a.total===0,i.value=!1,m.value=[],Object.keys(p).forEach(t=>{delete p[t]})}function E(){i.value=!i.value}function I(){if(r.value.length<=1)return;const[t]=r.value.splice(0,1);r.value.push(t),i.value=!1}function N(){var o;if(!m.value.length)return;const t=m.value.pop(),e=(o=c.value)==null?void 0:o.cards.find(l=>l.id===t);e&&(r.value.unshift(e),a.completed>0&&(a.completed-=1),y.value=!1,i.value=!1)}function B(t){var l;if(!v.value||!c.value||!_.value||!i.value)return;const e=v.value;let o=null;if(G(h=>{const T=h.courses.find(g=>g.id===_.value.id);if(!T)return;const b=T.stages.find(g=>g.id===c.value.id);if(!b)return;const x=b.cards.find(g=>g.id===e.id);x&&(o=ae(x,t),b.points=(b.points||0)+o.points,oe(b))}),!!o){if(a.reviewed+=1,a.points+=o.points,m.value.push(e.id),r.value.shift(),o.requeue){const h=(l=p[e.id])!=null?l:0;h<2?(p[e.id]=h+1,r.value.splice(Math.min(3,r.value.length),0,e)):(p[e.id]=0,a.completed+=1)}else p[e.id]=0,a.completed+=1;r.value.length||(y.value=!0,M("notify","Session complete! Great work.")),i.value=!1}}function P(t){var o;const e=(o=t.target)==null?void 0:o.tagName;e&&["INPUT","TEXTAREA","SELECT"].includes(e)||(["1","2","3","4"].includes(t.key)?(t.preventDefault(),B(Number(t.key))):t.key===" "||t.code==="Space"?(t.preventDefault(),E()):t.key==="ArrowRight"?(t.preventDefault(),I()):t.key==="ArrowLeft"?(t.preventDefault(),N()):t.key==="ArrowDown"?(t.preventDefault(),i.value=!0):t.key==="ArrowUp"&&(t.preventDefault(),i.value=!1))}return U(c,t=>{t&&!C.value&&(K(),C.value=!0)},{immediate:!0}),U(()=>w.params.stageId,()=>{C.value=!1}),W(()=>{window.addEventListener("keydown",P)}),X(()=>{window.removeEventListener("keydown",P)}),(t,e)=>{const o=se("router-link");return c.value&&_.value?(d(),u("section",le,[s("header",ie,[s("div",null,[s("p",re,n(_.value.title)+" · "+n(c.value.title),1),e[0]||(e[0]=s("h1",null,"Revision session",-1)),e[1]||(e[1]=s("p",null,"Keyboard shortcuts: arrow keys to navigate, space to flip, numbers 1-4 to grade.",-1))]),s("div",ue,[s("div",null,[e[2]||(e[2]=s("span",{class:"meta-label"},"Progress",-1)),s("span",de,n(S.value)+"%",1)]),s("div",null,[e[3]||(e[3]=s("span",{class:"meta-label"},"Points earned",-1)),s("span",ce,n(a.points),1)]),s("div",null,[e[4]||(e[4]=s("span",{class:"meta-label"},"Queue",-1)),s("span",ve,n(a.completed)+"/"+n(a.total),1)])])]),s("div",{class:"progress-bar",role:"progressbar","aria-valuenow":S.value,"aria-valuemin":"0","aria-valuemax":"100"},[s("div",{class:"progress-bar__value",style:V({width:S.value+"%"})},null,4)],8,pe),y.value?(d(),u("section",Be,[s("div",Pe,[e[10]||(e[10]=s("h2",null,"Session complete!",-1)),a.total===0?(d(),u("p",Te,"No cards were scheduled for review right now. Check back tomorrow or add new cards.")):(d(),u("p",xe,"You reviewed "+n(a.completed)+" card"+n(a.completed===1?"":"s")+" and earned "+n(a.points)+" points.",1)),s("div",Le,[D(o,{class:"button button--primary",to:{name:"StageDetail",params:{courseId:_.value.id,stageId:c.value.id}}},{default:R(()=>[...e[8]||(e[8]=[A("Review stage",-1)])]),_:1},8,["to"]),D(o,{class:"button button--ghost",to:{name:"Dashboard"}},{default:R(()=>[...e[9]||(e[9]=[A("Back to dashboard",-1)])]),_:1})])])])):(d(),u("section",_e,[v.value?(d(),u("article",{key:0,class:Y(["session-card",{"session-card--revealed":i.value}])},[s("header",fe,[s("span",null,"Card "+n(a.completed+1)+" of "+n(a.total),1),v.value.note?(d(),u("span",me,n(v.value.note),1)):q("",!0)]),s("div",he,[s("div",be,[e[5]||(e[5]=s("h2",null,"Prompt",-1)),s("p",null,n(v.value.front),1)]),s("div",ge,[e[6]||(e[6]=s("h2",null,"Answer",-1)),i.value?(d(),u("p",ke,n(v.value.back),1)):(d(),u("p",ye,"Press space or ↓ to reveal"))])]),s("footer",we,[s("div",Ce,[s("button",{class:"button button--ghost",type:"button",onClick:N,disabled:!z.value},"← Previous",8,Se),s("button",{class:"button button--ghost",type:"button",onClick:I,disabled:j.value<=1},"Skip →",8,De)]),s("button",{class:"button button--primary",type:"button",onClick:E},n(i.value?"Hide answer":"Reveal answer"),1)])],2)):q("",!0),s("aside",Re,[e[7]||(e[7]=s("h2",null,"How well did you remember?",-1)),s("ul",null,[(d(!0),u($,null,J(Z(F),l=>(d(),u("li",{key:l.key},[s("button",{class:"button button--review",style:V({"--accent":l.color}),type:"button",onClick:h=>B(l.value),disabled:!i.value},[s("span",Ee,n(l.shortcut),1),s("span",Ie,n(l.label),1)],12,Ae),s("p",Ne,n(l.description),1)]))),128))])])]))])):(d(),u("section",Ue,[s("div",Ve,[e[12]||(e[12]=s("h1",null,"Session unavailable",-1)),e[13]||(e[13]=s("p",null,"We couldn't find this stage. Return to the dashboard to pick another session.",-1)),D(o,{class:"button button--primary",to:{name:"Dashboard"}},{default:R(()=>[...e[11]||(e[11]=[A("Back to dashboard",-1)])]),_:1})])]))}}};export{Me as default};
